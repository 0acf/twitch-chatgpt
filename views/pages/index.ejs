<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
</head>

<body>
  <header>
    <%- include('../partials/header'); %>
  </header>

  <audio controls>
    <source id="audioSource" type="audio/mpeg">
    Your browser does not support the audio tag.
  </audio>

  <footer>
    <%- include('../partials/footer'); %>
  </footer>

  <script>
    function checkForUpdates() {
      // Create a WebSocket connection
      const socket = new WebSocket('wss://' + window.location.host + '/check-for-updates');

      // Handle messages from the server
      socket.addEventListener('message', (event) => {
        const data = JSON.parse(event.data);
        if (data.updated) {
          // If the file is updated, reload the audio source
          const audioElement = document.querySelector('audio');
          const audioSource = document.getElementById('audioSource');
            if (audioElement && audioSource) {
                audioSource.src = '/public/file.mp3?' + new Date().getTime();
            }
            audioElement.load();
            audioElement.play();
        }
      });

      // Handle WebSocket errors
      socket.addEventListener('error', (error) => {
        console.error('WebSocket error:', error);
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      checkForUpdates();
    });
  </script>

</body>
</html>
